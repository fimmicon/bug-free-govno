// Jenkinsfile (Scripted Pipeline)
node {
    stage('Download artifact') {
        sh '''
            # Remove ssh public keys (they can be old and not actual)
            ssh-keygen -f "/home/ubuntu/.ssh/known_hosts" -R "$IP_ADDRESS"
            # Gather actual SSH public keys from server
            ssh-keyscan -H $IP_ADDRESS >> /home/ubuntu/.ssh/known_hosts

            # Build inventory file for ansible
            cat <<EOF >inventory
            node1 ansible_host=$IP_ADDRESS ansible_user=$LINUX_USER ansible_password=$LINUX_PASS
            EOF

            cat inventory
        '''
    }

    stage('init-install') {
        sh '''
            pwd
            ls -la
            echo test_parameter = $LINUX_USER
        '''
    }
}